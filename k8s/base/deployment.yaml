apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: sparql-statefulset
spec:
  # selector.matchLabels is provided via Kustomize
  template:
    spec:
      containers:
        - name: sparql
          image: europeana/sparql
          ports:
            - containerPort: 8890
          env:
            # Note that after 50 seconds any connection in our k8s is automatically terminated
            - name: VIRT_SPARQL_MaxQueryExecutionTime
              value: "45"
          volumeMounts:
            - name: config
              mountPath: "/opt/app/config/sparql-updater.user.properties"
              readOnly: true
              subPath: sparql-updater.user.properties
      volumes:
        - name: config
          configMap:
            name: sparql-updater-config